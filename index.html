
<!DOCTYPE html>
<html>
<head>
  <title>Userdata</title>

  <!-- I would prefer protocoll-less urls, but seems as it does not work with file:// base urls-->
  <link href="stylesheets/bootstrap.css" media="all" rel="stylesheet" type="text/css" />
  <link href="stylesheets/application.css" media="all" rel="stylesheet" type="text/css" />
  <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/css/bootstrap-combined.min.css" rel="stylesheet">

  <!-- add scripts to head, content is rendered by Angular anyway so it doesn't matter, and: it's recommended -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.min.js"></script>
  <script src="http://angular-ui.github.com/bootstrap/ui-bootstrap-tpls-0.1.0.js"></script>
  <script src="javascripts/storage.js"></script>
  <script src="javascripts/data.js"></script>
  <script src="javascripts/helpers.js"></script>
  <script src="javascripts/users_controller.js"></script>
  
</head>
<body ng-app="TestApp">
<div ng-controller="UserController" class="container">
  <header ng-bind="header"></header>
  
  <p>
    <button id="addNewUserBtn" class="btn" ng-click="showNewCustomerForm()">Add new Customer</button> 
  </p>

  <table class="table table-striped table-bordered">
    <tr>
      <!-- better generate table header automatically. 
        Thoughts:
          <th ng-repeat="key in userData[0]">{{key}}</th>
        with some kind of mapping, or:
          provide a titles array stored in DB/localStorage
      -->
      <th>Customer ID</th>
      <th>First Name</th>
      <th>Last Name</th>
      <th>Age</th>
      <th>Gender</th>
      <th>Actions</th>
    </tr>
    <!-- use of ng-bind instead of curlies prevents flickering -->
    <tr ng-repeat="user in userData | orderBy:'-last_contact'">
      <td ng-bind="user.customer_id"></td>
      <td ng-bind="user.first_name"></td>
      <td ng-bind="user.last_name"></td>
      <!--<td ng-bind="user.last_contact"></td>-->
      <td ng-bind="calculateAgeByBirthdate(user.birthday)"></td>
      <td ng-bind="translateGender(user.gender)"></td>
      <td>
        <!-- TODO: take care of active/inactive state  -->
        <button class="btn btn-sm" ng-click="showEditCustomerForm(user)">Edit</button>
        <button class="btn btn-sm" ng-click="removeUser(user)">Delete</button>
        <button class="btn btn-sm" ng-click="showNaviForCustomer(user)">Navi</button>
      </td>
    </tr>
  </table>
</div>

<div id="modal-templates">
  <div id="modal-template-show">
    <div class="modal-header">
      <h3>Navigation Data of Customer {{item.first_name}} {{item.last_name}}</h1>
    </div>
    <div class="modal-body">
       <div>
        <table  class="table table-striped table-bordered">
          <tr>
            <th>Page</th>
            <th>Timestamp</th>
          </tr>
          <tr ng-repeat="navi in item.navigation | orderBy:'-timestamp'">
            <td ng-bind="navi.pages"></td>
            <td ng-bind="navi.timestamp"></td>
          </tr>
        </table>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-sm btn-left" ng-click="close()">Back to overview</button>
    </div>
  </div>

  <div id="modal-template-edit">
    <div class="modal-header">
      <h3>Edit Customer {{item.first_name}} {{item.last_name}}</h1>
    </div>
    <div class="modal-body">
      <form name="editUserForm"><!-- validation seems to require form tag, also it's not required to handle data... -->
        <ul>
          <li>
            <label for="edit_customer_id">Customer ID</label>
            <span ng-bind="item.customer_id"></span>
            <input type="hidden" ng-model="item.customer_id" required>
          </li>
          <li>
            <label for="edit_first_name">First Name</label>
            <input type="text" id="edit_first_name" name="edit_first_name" ng-model="item.first_name" ng-min="3" required>
          </li>
          <li>
            <label for="edit_last_name">Last Name</label>
            <input type="text" id="edit_last_name" name="edit_last_name" ng-model="item.last_name" ng-min="3" required>
          </li>
          <li>
            <label for="edit_birthday">Birthday</label>
            <input type="text" id="edit_birthday" name="edit_birthday" placeholder="(yyyy-mm-dd)" ng-model="item.birthday" ng-pattern="/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/" required>
          </li>
          <li>
            <label for="edit_gender">Gender</label>
            <select id="edit_gender" name="edit_gender" ng-model="item.gender" required>
              <option value="w">Female</option>
              <option value="m">Male</option>
            </select>
          </li>
          <li>
            <label for="edit_last_contact">Last Contact</label>
            <input type="text" id="edit_last_contact" name="edit_last_contact" placeholder="(yyyy-mm-dd)" ng-pattern="/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/" ng-model="item.last_contact">
          </li>
          <li>
            <label for="edit_customer_lifetime_value">Customer Lifetime Value</label>
            <input type="text" id="edit_customer_lifetime_value" name="item.customer_lifetime_value" placeholder="" ng-model="item.customer_lifetime_value">
          </li>
        </ul>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-sm btn-left" ng-click="close()">Back to overview</button>
      <button ng-click="saveCustomer()" class="btn btn-primary" ng-disabled="!editUserForm.$valid">Save</button>
    </div>
  </div>

  <div id="modal-template-new">
    <div class="modal-header">
      <h3>Add new Customer</h1>
    </div>
    <div class="modal-body">
      <form name="newUserForm">
        <ul>
          <li>
            <label for="edit_customer_id">Customer ID</label>
            <span ng-bind="item.customer_id"></span>
          </li>
          <li>
            <label for="edit_first_name">First Name</label>
            <input type="text" id="edit_first_name" name="edit_first_name" ng-model="item.first_name" required>
          </li>
          <li>
            <label for="edit_last_name">Last Name</label>
            <input type="text" id="edit_last_name" name="edit_last_name" ng-model="item.last_name" required>
          </li>
          <li>
            <label for="edit_birthday">Birthday</label>
            <input type="text" id="edit_birthday" name="edit_birthday" placeholder="(yyyy-mm-dd)" ng-model="item.birthday" ng-pattern="/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/" required>
          </li>
          <li>
            <label for="edit_gender">Gender</label>
            <select id="edit_gender" name="edit_gender" ng-model="item.gender" required>
              <option value="w">Female</option>
              <option value="m">Male</option>
            </select>
          </li>
        </ul>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-sm btn-left" ng-click="close()">Back to overview</button>
      <button ng-click="addCustomer()" class="btn btn-primary" ng-disabled="!newUserForm.$valid">Save</button>
    </div>
  </div>
</div>
</body>
</html>